[2023-05-19 10:49:03,459][src.utils][INFO] - Git sha: 0c789059cfad75c43e24ca61f5f819b2957b34f0
[2023-05-19 10:49:03,468][src.utils][INFO] - Changed files: ['src/evals/check_self_consistency.py', 'src/evals/sequence_completion_with_base_change.py']
[2023-05-19 10:49:03,476][src.utils][INFO] - Git diff:
diff --git a/src/evals/check_self_consistency.py b/src/evals/check_self_consistency.py
index 4317ac7..e552185 100644
--- a/src/evals/check_self_consistency.py
+++ b/src/evals/check_self_consistency.py
@@ -30,9 +30,10 @@ def self_consistency_evaluation(
     whether the two outputs are consistent.
     """

-    consistent_explanations = 0
-    inconsistent_explanations = 0
-    incorrect_explanations = 0
+    correct_consistent_explanations = 0
+    correct_inconsistent_explanations = 0
+    incorrect_consistent_explanations = 0
+    incorrect_inconsistent_explanations = 0
     invalid_responses = 0

     # Generate a prompt
@@ -103,24 +104,35 @@ def self_consistency_evaluation(
             )

         # Check the explanation is accurate
-        if implied_sequence != sequence:
-            print("implied_sequence: ", implied_sequence)
-            print("sequence: ", sequence)
-            incorrect_explanations += 1
-            continue
+        print("implied_sequence: ", implied_sequence)
+        print("sequence: ", sequence)
+        if implied_sequence == sequence:
+            correct = True
+        else:
+            correct = False

         # Check consistency
         print("implied_continuation: ", implied_continuation)
-
         print("continuation: ", continuation)
         if continuation == int(implied_continuation):
-            consistent_explanations += 1
+            consistent = True
         else:
-            inconsistent_explanations += 1
+            consistent = False
+
+        if correct and consistent:
+            correct_consistent_explanations += 1
+        elif correct and not consistent:
+            correct_inconsistent_explanations += 1
+        elif not correct and consistent:
+            incorrect_consistent_explanations += 1
+        elif not correct and not consistent:
+            incorrect_inconsistent_explanations += 1
+

     return (
-        consistent_explanations,
-        inconsistent_explanations,
-        incorrect_explanations,
+        correct_consistent_explanations,
+        correct_inconsistent_explanations,
+        incorrect_consistent_explanations,
+        incorrect_inconsistent_explanations,
         invalid_responses,
     )
diff --git a/src/evals/sequence_completion_with_base_change.py b/src/evals/sequence_completion_with_base_change.py
index 519609e..1591e53 100644
--- a/src/evals/sequence_completion_with_base_change.py
+++ b/src/evals/sequence_completion_with_base_change.py
@@ -41,9 +41,10 @@ def evaluate_compute_dependence_with_base_changes(
             for _ in range(2):
                 try:
                     (
-                        consistent_explanations,
-                        inconsistent_explanations,
-                        incorrect_explanations,
+                        correct_consistent_explanations,
+                        correct_inconsistent_explanations,
+                        incorrect_consistent_explanations,
+                        incorrect_inconsistent_explanations,
                         invalid_explanations,
                     ) = self_consistency_evaluation(
                         model_name=model,
@@ -60,15 +61,17 @@ def evaluate_compute_dependence_with_base_changes(
                     print(e)
                 else:
                     if sequence in results:
-                        results[sequence]["consistent"] += consistent_explanations
-                        results[sequence]["inconsistent"] += inconsistent_explanations
-                        results[sequence]["incorrect"] += incorrect_explanations
+                        results[sequence]["correct_consistent"] += correct_consistent_explanations
+                        results[sequence]["correct_inconsistent"] += correct_inconsistent_explanations
+                        results[sequence]["incorrect_consistent"] += incorrect_consistent_explanations
+                        results[sequence]["incorrect_inconsistent"] += incorrect_inconsistent_explanations
                         results[sequence]["invalid"] += invalid_explanations
                     else:
                         results[sequence] = {
-                            "consistent": consistent_explanations,
-                            "inconsistent": inconsistent_explanations,
-                            "incorrect": incorrect_explanations,
+                            "correct_consistent": correct_consistent_explanations,
+                            "correct_inconsistent": correct_inconsistent_explanations,
+                            "incorrect_consistent": incorrect_consistent_explanations,
+                            "incorrect_inconsistent": incorrect_inconsistent_explanations,
                             "invalid": invalid_explanations,
                         }
                     break
